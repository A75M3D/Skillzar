<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Clone | تيك توك</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ff0050',
                        secondary: '#00f2ea',
                        dark: '#121212',
                        card: '#1e1e1e',
                    },
                    fontFamily: {
                        'arabic': ['Tajawal', 'Segoe UI', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .snap-y-mandatory {
            scroll-snap-type: y mandatory;
        }
        .snap-start {
            scroll-snap-align: start;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .gradient-text {
            background: linear-gradient(45deg, #ff0050, #00f2ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-up {
            animation: slideUp 0.3s;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .video-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-dark text-white font-arabic" dir="rtl">
    <div class="max-w-md mx-auto h-screen bg-dark relative overflow-hidden">
        <!-- شريط الحالة -->
        <div class="fixed top-0 left-0 right-0 z-50 bg-dark pt-2 pb-1 px-4 max-w-md mx-auto">
            <div class="flex justify-between items-center text-white">
                <div class="text-sm font-semibold" id="current-time">10:30</div>
                <div class="flex space-x-2 space-x-reverse">
                    <i class="fas fa-signal text-xs"></i>
                    <i class="fas fa-wifi text-xs"></i>
                    <i class="fas fa-battery-three-quarters text-xs"></i>
                </div>
            </div>
        </div>

        <!-- شريط التنقل العلوي -->
        <div class="fixed top-8 left-0 right-0 z-40 bg-dark pt-4 pb-3 px-4 max-w-md mx-auto">
            <div class="flex justify-between items-center">
                <div class="text-lg font-bold" id="page-title">For You</div>
                <div class="flex space-x-4 space-x-reverse">
                    <div class="flex space-x-4 space-x-reverse mr-4">
                        <div class="nav-tab font-medium text-white relative cursor-pointer" onclick="switchTab('trending')">Trending</div>
                        <div class="nav-tab font-medium text-gray-400 relative cursor-pointer" onclick="switchTab('music')">
                            Music
                        </div>
                    </div>
                    <i class="fas fa-search text-xl cursor-pointer" onclick="openSearch()"></i>
                </div>
            </div>
        </div>

        <!-- شريط البحث -->
        <div id="search-bar" class="fixed top-8 left-0 right-0 z-40 bg-dark pt-4 pb-3 px-4 max-w-md mx-auto hidden slide-up">
            <div class="flex items-center">
                <div class="relative flex-1">
                    <input type="text" id="search-input" placeholder="ابحث في اليوتيوب..." 
                           class="w-full bg-gray-800 rounded-full py-2 px-4 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                    <i class="fas fa-search absolute right-3 top-2.5 text-gray-400"></i>
                </div>
                <button class="mr-2 text-gray-400" onclick="closeSearch()">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>

        <!-- منطقة الفيديوهات الرئيسية -->
        <div id="video-feed" class="h-full overflow-y-auto snap-y-mandatory scrollbar-hide pt-20 pb-16">
            <!-- سيتم إضافة الفيديوهات ديناميكياً -->
        </div>

        <!-- منطقة نتائج البحث -->
        <div id="search-results" class="h-full overflow-y-auto scrollbar-hide pt-20 pb-16 hidden">
            <!-- سيتم إضافة نتائج البحث هنا -->
        </div>

        <!-- شاشة التحميل -->
        <div id="loading-screen" class="fixed inset-0 bg-dark z-50 flex flex-col items-center justify-center max-w-md mx-auto">
            <div class="text-6xl text-primary mb-6 pulse">
                <i class="fab fa-youtube"></i>
            </div>
            <div class="text-xl font-semibold mb-2">جاري تحميل الفيديوهات</div>
            <div class="text-gray-400 text-sm">من YouTube API</div>
            <div class="w-48 h-1 bg-gray-800 rounded-full mt-6 overflow-hidden">
                <div class="h-full bg-primary rounded-full animate-pulse"></div>
            </div>
        </div>

        <!-- شريط التنقل السفلي -->
        <div class="fixed bottom-0 left-0 right-0 z-50 bg-dark border-t border-gray-800 max-w-md mx-auto">
            <div class="flex justify-around items-center py-2">
                <!-- Home -->
                <div class="flex flex-col items-center cursor-pointer" onclick="switchTab('trending')">
                    <i class="fas fa-home text-xl text-white"></i>
                    <span class="text-xs mt-1 text-white">Home</span>
                </div>
                
                <!-- Discover -->
                <div class="flex flex-col items-center cursor-pointer" onclick="openSearch()">
                    <i class="fas fa-search text-xl text-gray-400"></i>
                    <span class="text-xs mt-1 text-gray-400">Discover</span>
                </div>
                
                <!-- Upload -->
                <div class="flex flex-col items-center cursor-pointer -mt-4" onclick="showUploadInfo()">
                    <div class="bg-gray-400 w-10 h-8 rounded flex items-center justify-center pulse">
                        <i class="fas fa-plus text-white"></i>
                    </div>
                </div>
                
                <!-- Profile -->
                <div class="flex flex-col items-center cursor-pointer">
                    <i class="fas fa-user text-xl text-gray-400"></i>
                    <span class="text-xs mt-1 text-gray-400">Profile</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // مفتاح YouTube API - يمكنك استبداله بمفتاحك
        const YOUTUBE_API_KEY = 'AIzaSyASUAnslGu-5VWpvwtR9Huf6v3Qsk6MEE4';
        
        // حالة التطبيق
        const appState = {
            currentUser: null,
            videos: [],
            searchResults: [],
            currentVideoIndex: 0,
            isPlaying: true,
            isMuted: true,
            currentTab: 'trending',
            searchQuery: '',
            nextPageToken: ''
        };

        // تهيئة التطبيق
        async function initApp() {
            updateTime();
            setInterval(updateTime, 60000);
            
            setupEventListeners();
            
            // تحميل الفيديوهات الشائعة أولاً
            await loadTrendingVideos();
            
            // إخفاء شاشة التحميل بعد 2 ثانية
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
            }, 2000);
        }

        // تحديث الوقت
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-EG', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            document.getElementById('current-time').textContent = timeString;
        }

        // جلب الفيديوهات الشائعة من YouTube
        async function loadTrendingVideos() {
            try {
                showLoading();
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&chart=mostPopular&regionCode=US&maxResults=10&key=${YOUTUBE_API_KEY}`
                );
                
                const data = await response.json();
                
                if (data.items) {
                    appState.videos = data.items.map(item => ({
                        id: item.id,
                        snippet: item.snippet,
                        statistics: item.statistics,
                        contentDetails: item.contentDetails,
                        videoUrl: `https://www.youtube.com/embed/${item.id}?autoplay=1&mute=1&controls=0&modestbranding=1&rel=0&playsinline=1`
                    }));
                    
                    renderVideos();
                }
            } catch (error) {
                console.error('Error fetching trending videos:', error);
                showError('فشل في تحميل الفيديوهات');
            } finally {
                hideLoading();
            }
        }

        // جلب فيديوهات الموسيقى
        async function loadMusicVideos() {
            try {
                showLoading();
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=music&maxResults=10&key=${YOUTUBE_API_KEY}`
                );
                
                const data = await response.json();
                
                if (data.items) {
                    // جلب التفاصيل الإضافية لكل فيديو
                    const videoIds = data.items.map(item => item.id.videoId).join(',');
                    const detailsResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&id=${videoIds}&key=${YOUTUBE_API_KEY}`
                    );
                    
                    const detailsData = await detailsResponse.json();
                    
                    appState.videos = detailsData.items.map(item => ({
                        id: item.id,
                        snippet: item.snippet,
                        statistics: item.statistics,
                        contentDetails: item.contentDetails,
                        videoUrl: `https://www.youtube.com/embed/${item.id}?autoplay=1&mute=1&controls=0&modestbranding=1&rel=0&playsinline=1`
                    }));
                    
                    renderVideos();
                }
            } catch (error) {
                console.error('Error fetching music videos:', error);
                showError('فشل في تحميل فيديوهات الموسيقى');
            } finally {
                hideLoading();
            }
        }

        // البحث في YouTube
        async function searchVideos(query) {
            try {
                showLoading();
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&maxResults=15&key=${YOUTUBE_API_KEY}`
                );
                
                const data = await response.json();
                
                if (data.items) {
                    // جلب التفاصيل الإضافية لكل فيديو
                    const videoIds = data.items.map(item => item.id.videoId).join(',');
                    const detailsResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&id=${videoIds}&key=${YOUTUBE_API_KEY}`
                    );
                    
                    const detailsData = await detailsResponse.json();
                    
                    appState.searchResults = detailsData.items.map(item => ({
                        id: item.id,
                        snippet: item.snippet,
                        statistics: item.statistics,
                        contentDetails: item.contentDetails,
                        videoUrl: `https://www.youtube.com/embed/${item.id}`
                    }));
                    
                    renderSearchResults();
                }
                
                appState.nextPageToken = data.nextPageToken || '';
            } catch (error) {
                console.error('Error searching videos:', error);
                showError('فشل في البحث');
            } finally {
                hideLoading();
            }
        }

        // عرض الفيديوهات
        function renderVideos() {
            const videoFeed = document.getElementById('video-feed');
            videoFeed.innerHTML = '';
            
            appState.videos.forEach((video, index) => {
                const videoElement = createVideoElement(video, index);
                videoFeed.appendChild(videoElement);
            });
        }

        // إنشاء عنصر فيديو
        function createVideoElement(video, index) {
            const videoContainer = document.createElement('div');
            videoContainer.className = 'h-screen snap-start relative bg-black flex justify-center fade-in';
            
            const title = video.snippet.title;
            const channel = video.snippet.channelTitle;
            const views = formatCount(video.statistics.viewCount);
            const likes = formatCount(video.statistics.likeCount);
            const thumbnail = video.snippet.thumbnails.maxres?.url || video.snippet.thumbnails.high?.url;
            
            videoContainer.innerHTML = `
                <!-- شريط التقدم -->
                <div class="absolute top-14 left-4 right-4 z-30">
                    <div class="flex space-x-1">
                        ${appState.videos.map((_, i) => `
                            <div class="h-1 flex-1 rounded-full ${i === index ? 'bg-white' : 'bg-gray-600'}"></div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- فيديو اليوتيوب -->
                <div class="w-full h-full bg-black relative">
                    ${thumbnail ? `
                        <img src="${thumbnail}" alt="${title}" class="w-full h-full object-cover absolute inset-0">
                        <div class="absolute inset-0 bg-black bg-opacity-30"></div>
                    ` : ''}
                    
                    <iframe 
                        src="${video.videoUrl}&autoplay=${index === 0 ? 1 : 0}"
                        class="w-full h-full relative z-10"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
                
                <!-- معلومات الفيديو على اليسار -->
                <div class="absolute left-4 bottom-24 z-20 text-white text-shadow">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary mr-3 flex items-center justify-center">
                            <span class="font-bold text-white">${channel.charAt(0)}</span>
                        </div>
                        <div class="font-semibold">${channel}</div>
                        <button class="ml-4 bg-primary text-white text-xs font-semibold px-3 py-1 rounded" onclick="followChannel('${channel}')">متابعة</button>
                    </div>
                    <div class="mb-2 max-w-xs text-sm">${title}</div>
                    <div class="flex items-center text-xs mb-1">
                        <i class="fas fa-eye mr-2"></i>
                        <span>${views} مشاهدة</span>
                    </div>
                    <div class="flex items-center text-xs">
                        <i class="fas fa-music mr-2"></i>
                        <span>${channel}</span>
                    </div>
                </div>
                
                <!-- أزرار التفاعل على اليمين -->
                <div class="absolute right-4 bottom-24 z-20 flex flex-col items-center space-y-6">
                    <!-- صورة المستخدم -->
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center">
                            <span class="font-bold text-white text-lg">${channel.charAt(0)}</span>
                        </div>
                        <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2">
                            <div class="bg-primary rounded-full p-1">
                                <i class="fas fa-plus text-white text-xs"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- الإعجاب -->
                    <div class="flex flex-col items-center" onclick="toggleLike('${video.id}')">
                        <div class="p-2 rounded-full bg-black bg-opacity-50">
                            <i class="fas fa-heart text-2xl text-white"></i>
                        </div>
                        <span class="text-white text-xs mt-1 font-semibold">${likes}</span>
                    </div>
                    
                    <!-- التعليق -->
                    <div class="flex flex-col items-center" onclick="showComments('${video.id}')">
                        <div class="p-2 rounded-full bg-black bg-opacity-50">
                            <i class="fas fa-comment text-2xl text-white"></i>
                        </div>
                        <span class="text-white text-xs mt-1 font-semibold">${formatCount(video.statistics.commentCount)}</span>
                    </div>
                    
                    <!-- المشاركة -->
                    <div class="flex flex-col items-center" onclick="shareVideo('${video.id}')">
                        <div class="p-2 rounded-full bg-black bg-opacity-50">
                            <i class="fas fa-share text-2xl text-white"></i>
                        </div>
                        <span class="text-white text-xs mt-1 font-semibold">مشاركة</span>
                    </div>
                </div>
                
                <!-- زر كتم الصوت -->
                <button onclick="toggleMute()" class="absolute top-24 right-4 z-20 bg-black bg-opacity-50 rounded-full p-2">
                    <i class="fas fa-volume-mute text-white text-xl"></i>
                </button>
            `;
            
            return videoContainer;
        }

        // عرض نتائج البحث
        function renderSearchResults() {
            const searchResultsContainer = document.getElementById('search-results');
            searchResultsContainer.innerHTML = '';
            
            appState.searchResults.forEach(video => {
                const videoElement = createSearchResultElement(video);
                searchResultsContainer.appendChild(videoElement);
            });
        }

        // إنشاء عنصر نتيجة بحث
        function createSearchResultElement(video) {
            const resultElement = document.createElement('div');
            resultElement.className = 'bg-card rounded-xl mb-4 overflow-hidden fade-in cursor-pointer';
            resultElement.onclick = () => playVideo(video);
            
            const thumbnail = video.snippet.thumbnails.medium?.url;
            const duration = formatDuration(video.contentDetails.duration);
            const views = formatCount(video.statistics.viewCount);
            
            resultElement.innerHTML = `
                <div class="relative">
                    ${thumbnail ? `
                        <img src="${thumbnail}" alt="${video.snippet.title}" class="w-full h-40 object-cover">
                    ` : `
                        <div class="w-full h-40 bg-gradient-to-r from-primary to-secondary flex items-center justify-center">
                            <i class="fab fa-youtube text-white text-4xl"></i>
                        </div>
                    `}
                    <div class="absolute bottom-2 right-2 bg-black bg-opacity-80 text-white text-xs px-2 py-1 rounded">
                        ${duration}
                    </div>
                </div>
                <div class="p-3">
                    <h3 class="font-semibold mb-2 line-clamp-2 text-sm">${video.snippet.title}</h3>
                    <div class="flex justify-between text-xs text-gray-400">
                        <span>${video.snippet.channelTitle}</span>
                        <span>${views} مشاهدة</span>
                    </div>
                </div>
            `;
            
            return resultElement;
        }

        // تشغيل الفيديو
        function playVideo(video) {
            // إضافة الفيديو إلى بداية القائمة
            appState.videos.unshift({
                ...video,
                videoUrl: `https://www.youtube.com/embed/${video.id}?autoplay=1&mute=1&controls=0&modestbranding=1&rel=0&playsinline=1`
            });
            
            renderVideos();
            switchTab('trending');
        }

        // تنسيق الأعداد
        function formatCount(count) {
            if (!count) return '0';
            const num = parseInt(count);
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // تنسيق المدة
        function formatDuration(duration) {
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            if (!match) return '0:00';
            
            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');
            
            if (hours) {
                return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
            } else {
                return `${minutes}:${seconds.padStart(2, '0')}`;
            }
        }

        // إظهار التحميل
        function showLoading() {
            document.getElementById('loading-screen').classList.remove('hidden');
        }

        // إخفاء التحميل
        function hideLoading() {
            document.getElementById('loading-screen').classList.add('hidden');
        }

        // إظهار خطأ
        function showError(message) {
            alert(message);
        }

        // تبديل التبويبات
        async function switchTab(tab) {
            appState.currentTab = tab;
            
            // تحديث واجهة التبويبات
            document.querySelectorAll('.nav-tab').forEach((el, index) => {
                if ((tab === 'trending' && index === 0) || (tab === 'music' && index === 1)) {
                    el.classList.remove('text-gray-400');
                    el.classList.add('text-white');
                } else {
                    el.classList.remove('text-white');
                    el.classList.add('text-gray-400');
                }
            });
            
            // تحديث المحتوى
            if (tab === 'trending') {
                document.getElementById('video-feed').classList.remove('hidden');
                document.getElementById('search-results').classList.add('hidden');
                document.getElementById('page-title').textContent = 'Trending';
                await loadTrendingVideos();
            } else if (tab === 'music') {
                document.getElementById('video-feed').classList.remove('hidden');
                document.getElementById('search-results').classList.add('hidden');
                document.getElementById('page-title').textContent = 'Music';
                await loadMusicVideos();
            }
        }

        // فتح البحث
        function openSearch() {
            document.getElementById('search-bar').classList.remove('hidden');
            document.getElementById('page-title').classList.add('hidden');
            document.getElementById('search-input').focus();
        }

        // إغلاق البحث
        function closeSearch() {
            document.getElementById('search-bar').classList.add('hidden');
            document.getElementById('page-title').classList.remove('hidden');
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('video-feed').classList.remove('hidden');
        }

        // البحث في اليوتيوب
        function searchYouTube() {
            const query = document.getElementById('search-input').value;
            if (query.trim() === '') return;
            
            appState.searchQuery = query;
            document.getElementById('video-feed').classList.add('hidden');
            document.getElementById('search-results').classList.remove('hidden');
            
            searchVideos(query);
            
            // إظهار نتائج البحث
            document.getElementById('page-title').textContent = `نتائج البحث: ${query}`;
            document.getElementById('page-title').classList.remove('hidden');
            document.getElementById('search-bar').classList.add('hidden');
        }

        // وظائف التفاعل
        function toggleLike(videoId) {
            alert(`تم الإعجاب بالفيديو ${videoId}`);
        }

        function showComments(videoId) {
            alert(`تعليقات الفيديو ${videoId}`);
        }

        function shareVideo(videoId) {
            alert(`مشاركة الفيديو ${videoId}`);
        }

        function followChannel(channel) {
            alert(`متابعة القناة ${channel}`);
        }

        function toggleMute() {
            const iframes = document.querySelectorAll('iframe');
            appState.isMuted = !appState.isMuted;
            
            iframes.forEach(iframe => {
                const src = iframe.src;
                if (appState.isMuted) {
                    iframe.src = src.replace('mute=0', 'mute=1');
                } else {
                    iframe.src = src.replace('mute=1', 'mute=0');
                }
            });
        }

        function showUploadInfo() {
            alert('لرفع فيديو، ستحتاج إلى تفعيل YouTube Data API v3 وإضافة صلاحية uploading');
        }

        // إعداد معالجات الأحداث
        function setupEventListeners() {
            // البحث عند الضغط على Enter
            document.getElementById('search-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchYouTube();
                }
            });
        }

        // بدء التطبيق
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
